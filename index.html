<!DOCTYPE html>
<html lang="zh-TW">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>臺北市北投區文林國民小學附設幼兒園</title>
    <!-- 載入 Tailwind CSS 函式庫 -->
    <script src="https://cdn.tailwindcss.com"></script>
    <!-- 引入 Klee One (手寫簡約風) 和 Inter (內文清晰用) 字體 -->
    <link href="https://fonts.googleapis.com/css2?family=Inter:wght@400;600;700;800&family=Klee+One:wght@400;600&display=swap" rel="stylesheet">
    <style>
        body {
            /* 內文使用清晰的 Inter */
            font-family: 'Inter', sans-serif;
            scroll-behavior: smooth;
        }
        /* New style for main headings using the handwriting font */
        .handwriting-font {
            /* 標題使用手寫風格的 Klee One */
            font-family: 'Klee One', cursive;
        }
        /* 自定義一個柔和的背景圖案 (淺米白/奶油色) */
        .hero-bg {
            background-color: #fcf9f2; /* Light Cream/Beige */
            background-image: radial-gradient(#ffffff 1px, transparent 1px),
                              radial-gradient(#ffffff 1px, #fcf9f2 1px);
            background-size: 20px 20px;
            background-position: 0 0, 10px 10px;
        }
        /* 活躍 Tab 樣式 (茶綠色) */
        .tab-active {
            border-bottom: 3px solid #0f766e; /* Teal-700 */
            color: #0f766e; /* Teal-700 */
            font-weight: 700;
        }
        /* 表格樣式 */
        .data-table th, .data-table td {
            padding: 12px 15px;
            border-bottom: 1px solid #e5e7eb;
            text-align: left;
        }
        /* 隱藏原生 Radio Button */
        .class-radio input[type="radio"] {
            position: absolute;
            opacity: 0;
            width: 0;
            height: 0;
        }
        /* Radio Button 視覺效果 */
        .class-radio label {
            display: block;
            padding: 8px 12px;
            border-radius: 0.5rem;
            cursor: pointer;
            transition: all 0.2s;
            border: 1px solid #e5e7eb;
            background-color: #f3f4f6;
        }
        .class-radio input[type="radio"]:checked + label {
            background-color: #0f766e; /* Teal-700 */
            color: white;
            border-color: #0f766e;
            box-shadow: 0 2px 4px rgba(0,0,0,0.1);
        }
        /* 新增：簽名板樣式 */
        .signature-box {
            border: 2px solid #ccc;
            border-radius: 0.5rem;
            background-color: #fff;
            touch-action: none; /* 允許觸控繪圖 */
            box-sizing: border-box; /* 確保邊框不影響佈局 */
        }
        /* 新增：手機版教職員水平捲動容器 */
        #staff .scroll-container {
            overflow-x: auto;
            white-space: nowrap;
        }
        /* 新增：確保手機版教職員卡片有最小寬度 */
        #staff .staff-card {
            display: inline-block;
            width: 150px; /* 最小寬度 */
            margin-right: 1rem;
            white-space: normal;
        }
    </style>
</head>
<body class="text-stone-700">
    
    <!-- 導覽列 (Header) -->
    <header class="sticky top-0 z-50 bg-white shadow-xl">
        <div class="max-w-7xl mx-auto px-4 sm:px-6 lg:px-8">
            <div class="flex justify-between items-center h-20">
                
                <!-- Logo/臺北市北投區文林國民小學附設幼兒園 - 已刪除 SVG 圖示並調整字體大小 -->
                <a href="#home" class="flex items-center space-x-2">
                    <span class="text-2xl lg:text-3xl font-bold text-stone-800 handwriting-font whitespace-nowrap">臺北市北投區文林國民小學附設幼兒園</span>
                </a>

                <!-- 導覽連結 (桌面版) -->
                <nav class="hidden lg:flex space-x-8 text-lg items-center">
                    <a href="#home" class="text-stone-600 hover:text-teal-700 transition duration-150 font-medium">首頁簡介</a>
                    <a href="#news" class="text-stone-600 hover:text-teal-700 transition duration-150 font-medium">最新公告</a>
                    <a href="#about" class="text-stone-600 hover:text-teal-700 transition duration-150 font-medium">關於我們</a>
                    <a href="#gallery" class="text-stone-600 hover:text-teal-700 transition duration-150 font-medium">活動花絮</a>
                    <a href="#admin" class="text-stone-600 hover:text-teal-700 transition duration-150 font-medium">行政服務</a>
                    
                    <!-- 新增聯絡我們按鈕 -->
                    <button onclick="showContactModal()" class="px-4 py-2 bg-amber-600 text-white rounded-full hover:bg-amber-700 transition duration-150 font-medium shadow-md">聯絡我們</button>
                </nav>

                <!-- 手機版選單按鈕 (點擊彈出側邊選單) -->
                <button class="lg:hidden text-stone-500 hover:text-teal-700" onclick="toggleSidebar()">
                    <!-- Menu Icon -->
                    <svg class="w-7 h-7" fill="none" stroke="currentColor" viewBox="0 0 24 24" xmlns="http://www.w3.org/2000/svg"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M4 6h16M4 12h16m-7 6h7"></path></svg>
                </button>
            </div>
        </div>
    </header>

    <!-- 手機版側邊選單 (Sidebar Modal) -->
    <div id="mobile-sidebar" class="fixed inset-0 bg-gray-900 bg-opacity-75 hidden z-50">
        <div class="absolute right-0 top-0 w-64 h-full bg-white shadow-lg p-6 transform transition-transform duration-300 translate-x-full">
            <button class="absolute top-4 right-4 text-stone-400 hover:text-stone-700" onclick="toggleSidebar()">
                <svg class="w-6 h-6" fill="none" stroke="currentColor" viewBox="0 0 24 24"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M6 18L18 6M6 6l12 12"></path></svg>
            </button>
            <h3 class="text-xl font-bold text-teal-700 mb-6 handwriting-font">網站導覽</h3>
            <nav class="flex flex-col space-y-3">
                <a href="#home" onclick="toggleSidebar()" class="text-lg text-stone-700 hover:text-teal-700 transition duration-150">首頁簡介</a>
                <a href="#news" onclick="toggleSidebar()" class="text-lg text-stone-700 hover:text-teal-700 transition duration-150">最新公告</a>
                <a href="#about" onclick="toggleSidebar()" class="text-lg text-stone-700 hover:text-teal-700 transition duration-150">關於我們</a>
                <a href="#gallery" onclick="toggleSidebar()" class="text-lg text-stone-700 hover:text-teal-700 transition duration-150">活動花絮</a>
                <a href="#admin" onclick="toggleSidebar()" class="text-lg text-stone-700 hover:text-teal-700 transition duration-150">行政服務</a>
                <button onclick="showContactModal(); toggleSidebar();" class="mt-4 py-2 bg-amber-600 text-white font-bold rounded-lg hover:bg-amber-700 transition duration-150">聯絡我們</button>
            </nav>
        </div>
    </div>

    <main>
        
        <!-- 1. 首頁焦點區 (Hero Section) & 幼兒園簡介 (環境介紹、教學理念) -->
        <section id="home" class="hero-bg py-16 sm:py-24 lg:py-32">
            <div class="max-w-7xl mx-auto px-4 sm:px-6 lg:px-8 text-center">
                <div class="lg:w-3/4 mx-auto">
                    <h2 class="text-4xl sm:text-5xl lg:text-6xl font-extrabold text-stone-800 leading-tight mb-4 handwriting-font">
                        <span class="text-amber-600">閱讀自然</span>
                    </h2>
                    <p class="text-xl sm:text-2xl text-stone-600 mb-8">
                        和孩子一起創造安全、多元、快樂的學習環境。
                    </p>
                    <div class="mt-12 w-full max-w-5xl mx-auto rounded-xl overflow-hidden shadow-2xl">
                        <!-- 圖片已替換為靜態圖片 '入口.jpg' -->
                        <img src="入口.jpg" 
                             alt="文林附幼入口照片" 
                             class="w-full h-auto object-cover">
                    </div>
                </div>
            </div>
            
            <div class="max-w-7xl mx-auto px-4 sm:px-6 lg:px-8 mt-16">
                <!-- 簡介卡片區 -->
                <div class="grid grid-cols-1 lg:grid-cols-2 gap-12">
                    
                    <!-- 環境介紹 (茶綠色邊框) -->
                    <div class="bg-white p-8 rounded-3xl shadow-xl border-t-4 border-teal-500">
                        <h3 class="text-3xl font-extrabold text-teal-700 mb-4 handwriting-font">🏡 環境介紹</h3>
                        <p class="text-stone-600 mb-4">
                            幼兒園位於文林國小校區內，享有寬廣的戶外空間和資源。我們擁有獨立的遊戲場、沙坑、生態園區和陽光充足的活動室。所有的設施均通過安全檢驗，為幼兒提供一個無憂無慮的探索天地。
                        </p>
                        <ul class="text-sm text-stone-500 space-y-2 list-disc list-inside">
                            <li>多功能體能活動室</li>
                            <li>豐富的主題學習區</li>
                            <li>專屬的午睡與用餐區域</li>
                        </ul>
                    </div>
                    
                    <!-- 教學理念 (琥珀色邊框) -->
                    <div class="bg-white p-8 rounded-3xl shadow-xl border-t-4 border-amber-500">
                        <h3 class="text-3xl font-extrabold text-amber-700 mb-4 handwriting-font">💡 教學理念</h3>
                        <p class="text-stone-600 mb-4">
                            我們採學習區模式，以幼兒的生活經驗為核心，引導孩子從「做中學」。我們注重培養幼兒各個不同面向的能力，鼓勵孩子成為主動的學習者。
                        </p>
                        <ul class="text-sm text-stone-500 space-y-2 list-disc list-inside">
                            <li>以幼兒為中心的教學法</li>
                            <li>鼓勵動手操作與合作學習</li>
                            <li>重視生活自理能力與情商發展</li>
                        </ul>
                    </div>
                </div>
            </div>
        </section>

        <!-- 2. 最新公告欄位 (News Section) -->
        <section id="news" class="py-16 sm:py-24 bg-gray-50">
            <div class="max-w-7xl mx-auto px-4 sm:px-6 lg:px-8">
                <span class="text-sm font-semibold text-teal-700 uppercase tracking-wider">最新資訊</span>
                <h3 class="mt-2 text-3xl font-extrabold text-stone-800 sm:text-4xl mb-10 handwriting-font">
                    📢 文林附幼公告欄
                </h3>

                <div id="public-announcement-list" class="space-y-4">
                    <!-- 公告將由 JS 渲染 -->
                    <p class="text-stone-500 text-center py-4">載入公告中...</p>
                </div>
                
                <button class="mt-8 px-6 py-2 text-teal-700 font-semibold border border-teal-300 rounded-full hover:bg-teal-50 transition duration-150">
                    查看所有公告
                </button>
            </div>
        </section>

        <!-- 3. 關於我們 (About Us) - 使用 Tab 切換：行事曆、作息表、教職員介紹及班級網頁 -->
        <section id="about" class="py-16 sm:py-24 bg-white">
            <div class="max-w-7xl mx-auto px-4 sm:px-6 lg:px-8">
                <!-- 標題已修改 -->
                <h3 class="text-3xl font-extrabold text-stone-800 sm:text-4xl mb-10 text-center handwriting-font">
                    📖 關於我們與聯繫方式
                </h3>

                <!-- Tab 導覽列 (已新增聯絡資訊 Tab) -->
                <div id="about-tabs" class="flex flex-wrap justify-center border-b border-gray-200 mb-8 space-x-4 sm:space-x-8">
                    <button class="py-3 px-3 text-stone-600 hover:text-teal-700 tab-active" onclick="showAboutTab('calendar')">行事曆</button>
                    <button class="py-3 px-3 text-stone-600 hover:text-teal-700" onclick="showAboutTab('schedule')">作息表</button>
                    <button class="py-3 px-3 text-stone-600 hover:text-teal-700" onclick="showAboutTab('staff')">教職員介紹</button>
                    <button class="py-3 px-3 text-stone-600 hover:text-teal-700" onclick="showAboutTab('classes')">班級網頁</button>
                    <!-- 新增聯絡資訊 Tab -->
                    <button class="py-3 px-3 text-stone-600 hover:text-teal-700" onclick="showAboutTab('contact-info')">聯絡資訊</button>
                </div>

                <!-- Tab 內容區 -->
                <div id="about-content">
                    
                    <!-- 行事曆內容 (Default Tab) - 已連動教師後台數據 -->
                    <div id="calendar" class="tab-content bg-yellow-50 p-6 rounded-xl shadow-inner">
                        <h4 class="text-2xl font-bold text-teal-700 mb-4 handwriting-font">學年重要行事曆</h4>
                        <div id="calendar-table-container">
                            <!-- 行事曆數據將由 JS 渲染 -->
                            <p class="text-stone-500 text-center py-8">載入行事曆數據中...</p>
                        </div>
                    </div>

                    <!-- 作息表內容 (已更新) -->
                    <div id="schedule" class="tab-content hidden bg-yellow-50 p-6 rounded-xl shadow-inner">
                        <h4 class="text-2xl font-bold text-teal-700 mb-4 handwriting-font">幼兒園一日作息表</h4>
                        <div class="overflow-x-auto">
                            <table class="data-table w-full min-w-[700px] bg-white rounded-lg shadow-sm">
                                <thead>
                                    <tr class="bg-teal-100 text-teal-800 font-bold">
                                        <th class="w-[10%]">時間</th>
                                        <th class="w-[18%]">星期一</th>
                                        <th class="w-[18%]">星期二</th>
                                        <th class="w-[18%]">星期三</th>
                                        <th class="w-[18%]">星期四</th>
                                        <th class="w-[18%]">星期五</th>
                                    </tr>
                                </thead>
                                <tbody>
                                    <!-- 0730-0800 導護老師接送 (已統一並置中) -->
                                    <tr>
                                        <td class="font-semibold align-top text-center">07:30-08:00</td>
                                        <td colspan="5" class="text-sm text-stone-700 align-top text-center">
                                            導護老師於防洪教室看顧幼兒
                                        </td>
                                    </tr>
                                    <!-- 0800-0830 物品歸位/聯絡袋 (已更新並置中) -->
                                    <tr>
                                        <td class="font-semibold align-top text-center">08:00-08:30</td>
                                        <td colspan="5" class="text-sm align-top text-center">物品歸位及常規練習 (二至四) / 交聯絡袋資料 (一) / 收聯絡袋資料 (五)</td>
                                    </tr>
                                    <!-- 0830-1130 課程時段 (字體已縮小並置中) -->
                                    <tr>
                                        <td class="font-semibold align-top text-center">08:30-11:30</td>
                                        <td colspan="5" class="text-sm align-top p-0 border-none">
                                            <table class="w-full data-table border-none">
                                                <!-- 中大班 -->
                                                <tr>
                                                    <td class="w-[20%] font-bold text-teal-700 border-none text-center">●中大班群</td>
                                                    <td colspan="4" class="text-sm border-none text-center">
                                                        8:30-9:40 大肌肉體能活動、戶外自然探索 >> 9:40-10:00 享用點心 >> 10:00-11:30 學習區探索、紀錄與分享
                                                    </td>
                                                </tr>
                                                <!-- 中小班 -->
                                                <tr class="bg-teal-50">
                                                    <td class="w-[20%] font-bold text-amber-700 border-none text-center">●中小班群</td>
                                                    <td colspan="4" class="text-sm border-none text-center">
                                                        8:40-9:20 享用點心 >> 9:20-10:20 大肌肉體能活動、戶外自然探索 >> 10:20-11:30 學習區探索、紀錄與分享
                                                    </td>
                                                </tr>
                                                <!-- 幼幼班 -->
                                                <tr>
                                                    <td class="w-[20%] font-bold text-red-600 border-none text-center">●幼幼班群</td>
                                                    <td colspan="4" class="text-sm border-none text-center">
                                                        8:40-9:00 大肌肉體能活動 / 戶外自然探索 >> 9:20-10:00 享用點心 >> 10:00-10:40 學習區探索、紀錄與分享 >> 10:40-11:30 大肌肉體能活動/戶外自然探索
                                                    </td>
                                                </tr>
                                            </table>
                                        </td>
                                    </tr>
                                    <!-- 1130-1220 午餐相關 (已修正時段並置中) -->
                                    <tr>
                                        <td class="font-semibold align-top text-center">11:30-12:20</td>
                                        <td colspan="5" class="text-base align-top text-center font-bold">
                                            享用午餐 & 半日班放學
                                        </td>
                                    </tr>
                                    <!-- 1220-1250 環境清潔 & 睡前緩和活動 (已合併並置中) -->
                                    <tr>
                                        <td class="font-semibold align-top text-center">12:20-12:50</td>
                                        <td colspan="5" class="text-base align-top text-center">
                                            環境清潔 & 睡前緩和活動
                                        </td>
                                    </tr>
                                    <!-- 1250-1430 午休 (已更新並置中) -->
                                    <tr>
                                        <td class="font-semibold align-top text-center">12:50-14:30</td>
                                        <td colspan="5" class="text-base align-top text-center font-bold">
                                            午休
                                        </td>
                                    </tr>
                                    <!-- 1430-1500 寢具收拾 & 下午點心 (已更新並置中) -->
                                     <tr>
                                        <td class="font-semibold align-top text-center">14:30-15:00</td>
                                        <td colspan="5" class="text-base align-top text-center">
                                             寢具收拾 & 享用下午點心
                                        </td>
                                    </tr>
                                     <!-- 1500-1550 下午課程 (已更新並置中) -->
                                     <tr>
                                        <td class="font-semibold align-top text-center">15:00-15:50</td>
                                        <td colspan="5" class="text-base align-top text-center">
                                            宣導教育、體能活動、自然探索、故事閱讀、藝文賞析......
                                        </td>
                                    </tr>
                                    <!-- 1550-1600 分流放學 (已更新並置中) -->
                                    <tr>
                                        <td class="font-semibold align-top text-center">15:50-16:00</td>
                                        <td colspan="5" class="text-base align-top text-center font-bold">
                                            全日班分流放學
                                        </td>
                                    </tr>
                                    <!-- 1600-1830 課後留園 (已更新並置中) -->
                                    <tr>
                                        <td class="font-semibold align-top text-center">16:00-18:30</td>
                                        <td colspan="5" class="text-base align-top text-center">
                                            課後留園依報名時段參加
                                        </td>
                                    </tr>
                                </tbody>
                            </table>
                        </div>
                    
                        <!-- 備註區 (已移除) -->
                    </div>

                    <!-- 教職員介紹內容 (已更新：移除照片，簡化行政人員稱謂) -->
                    <div id="staff" class="tab-content hidden p-6">
                        <h4 class="text-2xl font-bold text-teal-700 mb-6 handwriting-font">教職員團隊</h4>

                        <h5 class="text-xl font-bold text-stone-800 mt-6 mb-4 border-b border-teal-300 pb-2">行政人員 (Administrative Staff)</h5>
                        <div class="grid grid-cols-2 md:grid-cols-4 gap-6">
                            <!-- 幼兒園主任 (職稱上移) -->
                            <div class="bg-white p-4 text-center rounded-xl shadow-md border-t-2 border-amber-400">
                                <p class="text-sm text-amber-700">幼兒園主任</p>
                                <p class="font-bold text-stone-800 mt-1">許昱蓁</p>
                            </div>
                            <!-- 行政教保員 (職稱上移) -->
                            <div class="bg-white p-4 text-center rounded-xl shadow-md border-t-2 border-amber-400">
                                <p class="text-sm text-amber-700">行政教保員</p>
                                <p class="font-bold text-stone-800 mt-1">林璟璿</p>
                            </div>
                            <!-- 廚工 1 (職稱上移) -->
                            <div class="bg-white p-4 text-center rounded-xl shadow-md border-t-2 border-stone-400">
                                <p class="text-sm text-stone-600">廚工</p>
                                <p class="font-bold text-stone-800 mt-1">莊淑慧</p>
                            </div>
                            <!-- 廚工 2 (職稱上移) -->
                            <div class="bg-white p-4 text-center rounded-xl shadow-md border-t-2 border-stone-400">
                                <p class="text-sm text-stone-600">廚工</p>
                                <p class="font-bold text-stone-800 mt-1">鄭雅萍</p>
                            </div>
                            <!-- 廚工 3 (職稱上移) -->
                            <div class="staff-card bg-white p-4 text-center rounded-xl shadow-md border-t-2 border-stone-400">
                                <p class="text-sm text-stone-600">廚工</p>
                                <p class="font-bold text-stone-800 mt-1">李愛琪</p>
                            </div>
                        </div>

                        <h5 class="text-xl font-bold text-stone-800 mt-8 mb-4 border-b border-teal-300 pb-2">班級教師 (Class Teachers)</h5>
                        <!-- 新增水平捲動容器 -->
                        <div class="scroll-container md:grid md:grid-cols-4 md:gap-6">
                            
                            <!-- 太陽班 (姓名下移) -->
                            <div class="staff-card bg-white p-4 text-center rounded-xl shadow-md border-t-2 border-teal-400">
                                <p class="text-xs text-stone-500 mb-1">☀️ 太陽班</p>
                                <p class="text-lg font-bold text-teal-700 leading-tight">周惠莉 老師</p>
                                <p class="text-lg font-bold text-teal-700 leading-tight">鍾美玲 老師</p>
                            </div>
                            <!-- 藍天班 (姓名下移) -->
                            <div class="staff-card bg-white p-4 text-center rounded-xl shadow-md border-t-2 border-teal-400">
                                <p class="text-xs text-stone-500 mb-1">☁️ 藍天班</p>
                                <p class="text-lg font-bold text-teal-700 leading-tight">林佳蒨 老師</p>
                                <p class="text-lg font-bold text-teal-700 leading-tight">張爾軒 老師</p>
                            </div>
                            <!-- 白雲班 (姓名下移) -->
                            <div class="staff-card bg-white p-4 text-center rounded-xl shadow-md border-t-2 border-teal-400">
                                <p class="text-xs text-stone-500 mb-1">🤍 白雲班</p>
                                <p class="text-lg font-bold text-teal-700 leading-tight">務琦 老師</p>
                                <p class="text-lg font-bold text-teal-700 leading-tight">林耘慈 老師</p>
                            </div>
                            <!-- 月亮班 (姓名下移) -->
                            <div class="staff-card bg-white p-4 text-center rounded-xl shadow-md border-t-2 border-teal-400">
                                <p class="text-xs text-stone-500 mb-1">🌙 月亮班</p>
                                <p class="text-lg font-bold text-teal-700 leading-tight">郭家禎 老師</p>
                                <p class="text-lg font-bold text-teal-700 leading-tight">陳應節 老師</p>
                            </div>
                            <!-- 星星班 (姓名下移) -->
                            <div class="staff-card bg-white p-4 text-center rounded-xl shadow-md border-t-2 border-teal-400">
                                <p class="text-xs text-stone-500 mb-1">⭐ 星星班</p>
                                <p class="text-lg font-bold text-teal-700 leading-tight">張曉萍 老師</p>
                                <p class="text-lg font-bold text-teal-700 leading-tight">張家瑜 老師</p>
                            </div>
                            <!-- 荳荳班 (姓名下移) -->
                            <div class="staff-card bg-white p-4 text-center rounded-xl shadow-md border-t-2 border-amber-400">
                                <p class="text-xs text-stone-500 mb-1">🌱 荳荳班</p>
                                <p class="text-lg font-bold text-amber-700 leading-tight">李雅芬 教保員</p>
                                <p class="text-lg font-bold text-amber-700 leading-tight">李品萱 教保員</p>
                            </div>
                            <!-- 朵朵班 (姓名下移) -->
                            <div class="staff-card bg-white p-4 text-center rounded-xl shadow-md border-t-2 border-amber-400">
                                <p class="text-xs text-stone-500 mb-1">🌸 朵朵班</p>
                                <p class="text-lg font-bold text-amber-700 leading-tight">鄭莉穎 教保員</p>
                                <p class="text-lg font-bold text-amber-700 leading-tight">洪銓莉 教保員</p>
                            </div>
                            <!-- 彩虹班 (姓名下移) -->
                            <div class="staff-card bg-white p-4 text-center rounded-xl shadow-md border-t-2 border-teal-400">
                                <p class="text-xs text-stone-500 mb-1">🌈 彩虹班</p>
                                <p class="text-lg font-bold text-teal-700 leading-tight">史佳玲 老師</p>
                                <p class="text-lg font-bold text-teal-700 leading-tight">朱育萱 老師</p>
                            </div>
                            
                            <div class="col-span-4 text-center text-sm text-stone-500 pt-4">
                                (註：教師照片欄位已移除)
                            </div>
                        </div>

                        <h5 class="text-xl font-bold text-stone-800 mt-8 mb-4 border-b border-teal-300 pb-2">其他人力資源 (Other Staff)</h5>
                        <div class="grid grid-cols-2 md:grid-cols-4 gap-6">
                            <!-- 實習生 (移除照片欄位) -->
                            <div class="bg-white p-4 text-center rounded-xl shadow-md border-t-2 border-green-400">
                                <p class="font-bold text-stone-800 mt-2">實習生</p>
                                <p class="text-sm text-green-700">依當學期配置</p>
                            </div>
                            <!-- 特教助理員 (移除照片欄位) -->
                            <div class="bg-white p-4 text-center rounded-xl shadow-md border-t-2 border-green-400">
                                <p class="font-bold text-stone-800 mt-2">特教助理員</p>
                                <p class="text-sm text-green-700">依需求配置</p>
                            </div>
                        </div>
                    </div>

                    <!-- 班級網頁內容 (班級名稱已確認) -->
                    <div id="classes" class="tab-content hidden bg-yellow-50 p-6 rounded-xl shadow-inner">
                        <h4 class="text-2xl font-bold text-teal-700 mb-6 handwriting-font">各班網頁連結</h4>
                        <div class="space-y-4">
                            <a href="#" class="block p-4 bg-white rounded-lg shadow hover:bg-gray-100 transition duration-150 font-semibold text-teal-600">☀️ 太陽班 - 點此進入班級網頁</a>
                            <a href="#" class="block p-4 bg-white rounded-lg shadow hover:bg-gray-100 transition duration-150 font-semibold text-green-700">☁️ 藍天班 - 點此進入班級網頁</a>
                            <a href="#" class="block p-4 bg-white rounded-lg shadow hover:bg-gray-100 transition duration-150 font-semibold text-amber-700">🤍 白雲班 - 點此進入班級網頁</a>
                            <a href="#" class="block p-4 bg-white rounded-lg shadow hover:bg-gray-100 transition duration-150 font-semibold text-teal-600">🌙 月亮班 - 點此進入班級網頁</a>
                            <a href="#" class="block p-4 bg-white rounded-lg shadow hover:bg-gray-100 transition duration-150 font-semibold text-green-700">⭐ 星星班 - 點此進入班級網頁</a>
                            <a href="#" class="block p-4 bg-white rounded-lg shadow hover:bg-gray-100 transition duration-150 font-semibold text-amber-700">🌱 荳荳班 - 點此進入班級網頁</a>
                            <a href="#" class="block p-4 bg-white rounded-lg shadow hover:bg-gray-100 transition duration-150 font-semibold text-teal-600">🌸 朵朵班 - 點此進入班級網頁</a>
                            <a href="#" class="block p-4 bg-white rounded-lg shadow hover:bg-gray-100 transition duration-150 font-semibold text-green-700">🌈 彩虹班 - 點此進入班級網頁</a>
                        </div>
                    </div>
                    
                    <!-- 新增聯絡資訊 Tab -->
                    <div id="contact-info" class="tab-content hidden bg-yellow-50 p-6 rounded-xl shadow-inner">
                        <h4 class="text-2xl font-bold text-teal-700 mb-6 handwriting-font">📞 聯絡資訊</h4>
                        <div class="bg-white p-6 rounded-lg shadow-md space-y-4">
                            <p class="text-xl font-bold text-stone-800 mb-4">臺北市北投區文林國民小學附設幼兒園</p>
                            
                            <div class="grid grid-cols-1 md:grid-cols-2 gap-4">
                                <div>
                                    <p class="font-bold text-teal-700">學校總機</p>
                                    <p class="text-lg">(02) 2823-4212</p>
                                </div>
                                <div>
                                    <p class="font-bold text-teal-700">辦公室分機</p>
                                    <p class="text-lg">辦公室: 800, 801</p>
                                </div>
                            </div>

                            <h5 class="text-lg font-bold text-amber-700 pt-3 border-t border-gray-100">各班級分機</h5>
                            <div class="grid grid-cols-2 sm:grid-cols-4 gap-x-4 gap-y-2 text-base">
                                <p>☀️ 太陽班: 809</p>
                                <p>☁️ 藍天班: 810</p>
                                <p>🤍 白雲班: 805</p>
                                <p>🌙 月亮班: 808</p>
                                <p>⭐ 星星班: 807</p>
                                <p>🌱 荳荳班: 803</p>
                                <p>🌸 朵朵班: 804</p>
                                <p>🌈 彩虹班: 806</p>
                            </div>
                        </div>
                    </div>

                </div>
            </div>
        </section>


        <!-- 4. 全園活動花絮 (Gallery) - 連結到 Google 相簿，並保留預覽圖 -->
        <section id="gallery" class="py-16 sm:py-24 hero-bg">
            <div class="max-w-7xl mx-auto px-4 sm:px-6 lg:px-8 text-center">
                <span class="text-sm font-semibold text-amber-600 uppercase tracking-wider">成長瞬間</span>
                <!-- 已刪除 2024-2025 學年的名稱 -->
                <h3 class="mt-2 text-3xl font-extrabold text-stone-800 sm:text-4xl mb-8 handwriting-font">
                    📸 全園活動花絮
                </h3>

                <!-- 相簿預覽 (4張圖片) - 從 localStorage 讀取圖片 URL -->
                 <div class="grid grid-cols-2 md:grid-cols-4 gap-4 max-w-4xl mx-auto mb-10" id="gallery-preview-container">
                    <!-- 圖片將由 JS 渲染 -->
                </div>
                
                <p class="text-lg text-stone-600 mb-8 max-w-2xl mx-auto">
                    點擊下方按鈕，連結至 Google 相簿或學校相簿系統，查看更多的全園活動照片和孩子們的精彩瞬間。
                </p>
                
                <!-- 獨立頁面連結按鈕 (已修正為指向 Google 相簿網址) -->
                <a href="https://photos.google.com/u/1/albums" target="_blank" 
                   class="mt-6 inline-block px-10 py-4 text-xl font-bold text-white bg-teal-600 rounded-full shadow-lg hover:bg-teal-700 transition duration-300 transform hover:scale-105">
                    點此進入全園相簿連結 →
                </a>
            </div>
        </section>

        <!-- 5. 行政服務 (Admin Forms) - 使用 Tab 切換：線上請假、託藥辦法及託藥申請 -->
        <section id="admin" class="py-16 sm:py-24 bg-white">
            <div class="max-w-7xl mx-auto px-4 sm:px-6 lg:px-8">
                 <h3 class="text-3xl font-extrabold text-stone-800 sm:text-4xl mb-10 text-center handwriting-font">
                    📋 家長行政服務區
                </h3>

                <!-- Tab 導覽列 -->
                <div id="admin-tabs" class="flex flex-wrap justify-center border-b border-gray-200 mb-8 space-x-4 sm:space-x-8">
                    <button class="py-3 px-3 text-stone-600 hover:text-teal-700 tab-active" onclick="showAdminTab('leave')">線上請假表單</button>
                    <button class="py-3 px-3 text-stone-600 hover:text-teal-700" onclick="showAdminTab('policy')">託藥辦法</button>
                    <button class="py-3 px-3 text-stone-600 hover:text-teal-700" onclick="showAdminTab('medication')">託藥申請表</button>
                </div>
                
                <!-- Tab 內容區 -->
                <div id="admin-content" class="bg-yellow-50 p-8 rounded-xl shadow-2xl">
                    
                    <!-- 線上請假表單 (Default Tab) - 已新增 Email 欄位 -->
                    <div id="leave" class="tab-content-admin">
                        <h4 class="text-2xl font-bold text-teal-700 mb-6 handwriting-font">幼兒線上請假通知單</h4>
                        <form id="leave-form" onsubmit="handleLeaveSubmit(event)">
                            <div class="space-y-4">
                                <div>
                                    <label class="block text-stone-700 font-medium mb-1">家長姓名</label>
                                    <input type="text" name="parentName" class="w-full p-3 border border-gray-300 rounded-lg focus:ring-amber-500 focus:border-amber-500" placeholder="請輸入家長全名" required>
                                </div>
                                <div>
                                    <label class="block text-stone-700 font-medium mb-1">家長與幼兒關係</label>
                                    <input type="text" name="relationship" class="w-full p-3 border border-gray-300 rounded-lg focus:ring-amber-500 focus:border-amber-500" placeholder="例如：爸爸/媽媽/祖母" required>
                                </div>
                                <div>
                                    <label class="block text-stone-700 font-medium mb-1">幼兒姓名</label>
                                    <input type="text" name="childName" class="w-full p-3 border border-gray-300 rounded-lg focus:ring-amber-500 focus:border-amber-500" placeholder="請輸入幼兒全名" required>
                                </div>
                                <!-- 新增 Email 欄位 -->
                                <div>
                                    <label class="block text-stone-700 font-medium mb-1">接收審核通知 Email</label>
                                    <input type="email" name="parentEmail" class="w-full p-3 border border-gray-300 rounded-lg focus:ring-amber-500 focus:border-amber-500" placeholder="用於接收審核結果" required>
                                </div>


                                <!-- 班級勾選 (單選) 欄位 -->
                                <fieldset>
                                    <legend class="block text-stone-700 font-medium mb-1">幼兒班級 (請單選)</legend>
                                    <div class="grid grid-cols-2 sm:grid-cols-4 gap-3 class-radio">
                                        <input type="radio" id="l-class-sun" name="className" value="太陽班" required><label for="l-class-sun">☀️ 太陽班</label>
                                        <input type="radio" id="l-class-sky" name="className" value="藍天班"><label for="l-class-sky">☁️ 藍天班</label>
                                        <input type="radio" id="l-class-cloud" name="className" value="白雲班"><label for="l-class-cloud">🤍 白雲班</label>
                                        <input type="radio" id="l-class-moon" name="className" value="月亮班"><label for="l-class-moon">🌙 月亮班</label>
                                        <input type="radio" id="l-class-star" name="className" value="星星班"><label for="l-class-star">⭐ 星星班</label>
                                        <input type="radio" id="l-class-bean" name="className" value="荳荳班"><label for="l-class-bean">🌱 荳荳班</label>
                                        <input type="radio" id="l-class-flower" name="className" value="朵朵班"><label for="l-class-flower">🌸 朵朵班</label>
                                        <input type="radio" id="l-class-rainbow" name="className" value="彩虹班"><label for="l-class-rainbow">🌈 彩虹班</label>
                                    </div>
                                </fieldset>

                                <!-- 區間式請假日期 -->
                                <div class="grid grid-cols-2 gap-4">
                                    <div>
                                        <label class="block text-stone-700 font-medium mb-1">請假開始日</label>
                                        <input type="date" name="startDate" class="w-full p-3 border border-gray-300 rounded-lg focus:ring-amber-500 focus:border-amber-500" required>
                                    </div>
                                    <div>
                                        <label class="block text-stone-700 font-medium mb-1">請假結束日</label>
                                        <input type="date" name="endDate" class="w-full p-3 border border-gray-300 rounded-lg focus:ring-amber-500 focus:border-amber-500" required>
                                    </div>
                                </div>

                                <div>
                                    <label class="block text-stone-700 font-medium mb-1">請假原因</label>
                                    <textarea name="reason" class="w-full p-3 border border-gray-300 rounded-lg focus:ring-amber-500 focus:border-amber-500" rows="3" placeholder="例如：發燒、家庭旅遊、事假" required></textarea>
                                </div>
                                
                                <!-- 家長簽名欄位 (Canvas) -->
                                <div class="space-y-2">
                                    <label class="block text-stone-700 font-medium mb-1">家長簽名 (請在框內簽名)</label>
                                    <canvas id="leaveSignatureCanvas" class="signature-box w-full h-32"></canvas>
                                    <button type="button" onclick="clearSignature('leaveSignatureCanvas')" class="w-full py-2 bg-red-500 text-white font-semibold rounded-lg hover:bg-red-600 transition">
                                        清除簽名
                                    </button>
                                </div>

                                <button type="submit" class="w-full py-3 bg-teal-700 text-white font-bold rounded-lg hover:bg-teal-800 transition duration-150 shadow-md">
                                    送出請假申請
                                </button>
                            </div>
                        </form>
                    </div>

                    <!-- 託藥辦法內容 -->
                    <div id="policy" class="tab-content-admin hidden">
                        <h4 class="text-2xl font-bold text-teal-700 mb-6 handwriting-font">💊 幼兒園委託幼兒服藥辦法</h4>
                        <div class="bg-white p-6 rounded-lg shadow-inner space-y-4 text-stone-700">
                            <p class="font-bold">一、基本原則：</p>
                            <p class="pl-4">幼兒服藥以在家自行服藥為原則，如因特殊疾病或療程需要，家長需填寫本園之「託藥申請表」。</p>
                            <p class="font-bold">二、託藥要求：</p>
                            <ul class="list-disc list-inside pl-4 space-y-2">
                                <li>藥品必須由**醫師開立**，並附有完整的藥袋、藥名、劑量、服藥時間及幼兒姓名。</li>
                                <li>園方僅協助餵食**當次劑量**，不接受自行分裝或非處方藥物（如：維他命、中藥材）。</li>
                                <li>藥物必須是**當日且當次**的劑量，不可存放隔夜藥。</li>
                            </ul>
                            <p class="font-bold">三、服藥流程：</p>
                            <p class="pl-4">幼兒入園時，由家長親自將藥品交給導師或保健人員，並簽署託藥單。服藥後，園方將記錄服藥情況。</p>
                        </div>
                    </div>

                    <!-- 託藥申請表內容 - 已重構用藥欄位 -->
                    <div id="medication" class="tab-content-admin hidden">
                        <!-- 修正標題 -->
                        <h4 class="text-2xl font-bold text-teal-700 mb-6 handwriting-font">委託用藥申請單</h4>
                        <form id="medication-form" onsubmit="handleMedicationSubmit(event)">
                             <div class="space-y-4">
                                <!-- 幼兒班級/姓名 -->
                                <div class="grid grid-cols-2 gap-4">
                                    <div>
                                        <label class="block text-stone-700 font-medium mb-1">幼兒班級 (請單選)</label>
                                        <select name="className" class="w-full p-3 border border-gray-300 rounded-lg focus:ring-amber-500 focus:border-amber-500" required>
                                            <option value="">請選擇</option>
                                            <option value="太陽班">☀️ 太陽班</option>
                                            <option value="藍天班">☁️ 藍天班</option>
                                            <option value="白雲班">🤍 白雲班</option>
                                            <option value="月亮班">🌙 月亮班</option>
                                            <option value="星星班">⭐ 星星班</option>
                                            <option value="荳荳班">🌱 荳荳班</option>
                                            <option value="朵朵班">🌸 朵朵班</option>
                                            <option value="彩虹班">🌈 彩虹班</option>
                                        </select>
                                    </div>
                                    <div>
                                        <label class="block text-stone-700 font-medium mb-1">幼兒姓名</label>
                                        <input type="text" name="childName" class="w-full p-3 border border-gray-300 rounded-lg focus:ring-amber-500 focus:border-amber-500" placeholder="請輸入幼兒全名" required>
                                    </div>
                                </div>

                                <!-- 用藥日期區間 -->
                                <div class="grid grid-cols-2 gap-4">
                                    <div>
                                        <label class="block text-stone-700 font-medium mb-1">用藥開始日期</label>
                                        <input type="date" name="startDate" class="w-full p-3 border border-gray-300 rounded-lg focus:ring-amber-500 focus:border-amber-500" required>
                                    </div>
                                    <div>
                                        <label class="block text-stone-700 font-medium mb-1">用藥結束日期</label>
                                        <input type="date" name="endDate" class="w-full p-3 border border-gray-300 rounded-lg focus:ring-amber-500 focus:border-amber-500" required>
                                    </div>
                                </div>
                                
                                <div>
                                    <label class="block text-stone-700 font-medium mb-1">病名或病徵</label>
                                    <input type="text" name="symptoms" class="w-full p-3 border border-gray-300 rounded-lg focus:ring-amber-500 focus:border-amber-500" placeholder="例如：感冒咳嗽、輕微發燒" required>
                                </div>
                                
                                <!-- 藥品名稱改為用藥內容 (重構) -->
                                <fieldset>
                                    <legend class="block text-stone-700 font-medium mb-2">用藥內容及分量</legend>
                                    <div class="space-y-3 p-3 bg-white rounded-lg border border-gray-300">
                                        <div class="flex items-center space-x-2">
                                            <input type="checkbox" id="med_powder" name="medType" value="藥粉/藥丸" class="h-4 w-4 text-teal-600 border-gray-300 rounded">
                                            <label for="med_powder" class="text-sm">1. 藥粉或藥丸，</label>
                                            <input type="text" name="powderQty" class="w-16 p-1 border rounded-lg text-sm" placeholder="數量">
                                            <span class="text-sm">包</span>
                                        </div>
                                        <div class="flex items-center space-x-2">
                                            <input type="checkbox" id="med_liquid" name="medType" value="藥水" class="h-4 w-4 text-teal-600 border-gray-300 rounded">
                                            <label for="med_liquid" class="text-sm">2. 藥水，</label>
                                            <input type="text" name="liquidQty" class="w-16 p-1 border rounded-lg text-sm" placeholder="數量">
                                            <span class="text-sm">c.c.</span>
                                        </div>
                                        <div class="flex items-center space-x-2">
                                            <input type="checkbox" id="med_other" name="medType" value="藥膏/其他" class="h-4 w-4 text-teal-600 border-gray-300 rounded">
                                            <label for="med_other" class="text-sm">3. 其他，</label>
                                            <input type="text" name="otherQty" class="w-20 p-1 border rounded-lg text-sm" placeholder="份量/內容">
                                        </div>
                                    </div>
                                </fieldset>
                                
                                <div>
                                    <label class="block text-stone-700 font-medium mb-1">服藥時間</label>
                                    <input type="text" name="time" class="w-full p-3 border border-gray-300 rounded-lg focus:ring-amber-500 focus:border-amber-500" placeholder="例如：午餐後 12:30" required>
                                </div>
                                
                                <!-- 備註欄位 (冰冷藏等) -->
                                <div>
                                    <label class="block text-stone-700 font-medium mb-1">其他注意事項</label>
                                    <textarea name="refrigerationNote" class="w-full p-3 border border-gray-300 rounded-lg focus:ring-amber-500 focus:border-amber-500" rows="2" placeholder="請註明是否需冷藏、特殊注意事項等"></textarea>
                                </div>
                                
                                <!-- 家長 Email -->
                                <div>
                                    <label class="block text-stone-700 font-medium mb-1">家長收訊息 Email</label>
                                    <input type="email" name="parentEmail" id="parent-email" class="w-full p-3 border border-gray-300 rounded-lg focus:ring-amber-500 focus:border-amber-500" placeholder="用於接收老師餵藥回覆" required>
                                </div>
                                
                                <!-- 處方簽確認勾選欄位 -->
                                <div class="flex items-center">
                                    <input type="checkbox" id="prescription_confirm" name="prescriptionConfirm" class="h-4 w-4 text-teal-600 border-gray-300 rounded focus:ring-teal-500" required>
                                    <label for="prescription_confirm" class="ml-2 text-sm text-stone-700 font-medium">我確認已附有醫療院所開立之處方簽</label>
                                </div>

                                <!-- 簽名欄位 (Canvas) -->
                                <div class="space-y-2">
                                    <label class="block text-stone-700 font-medium mb-1">家長簽名 (請在框內簽名)</label>
                                    <canvas id="medicationSignatureCanvas" class="signature-box w-full h-32"></canvas>
                                    <button type="button" onclick="clearSignature('medicationSignatureCanvas')" class="w-full py-2 bg-red-500 text-white font-semibold rounded-lg hover:bg-red-600 transition">
                                        清除簽名
                                    </button>
                                </div>

                                <button type="submit" class="w-full py-3 bg-amber-600 text-white font-bold rounded-lg hover:bg-amber-700 transition duration-150 shadow-md">
                                    送出託藥申請
                                </button>
                            </div>
                        </form>
                        
                        <!-- 教師餵藥後的回覆功能 (提示區) -->
                        <div class="mt-8 p-4 bg-teal-100 rounded-xl border-2 border-teal-300">
                            <p class="text-stone-700 font-semibold">教師回覆介面提示：</p>
                            <p class="text-sm text-stone-600 mt-1">
                                在真實系統中，老師將透過**獨立的後台網頁**（如 `teacher_admin_panel.html`）登入，並在專門的管理介面中查看此託藥單並進行回覆。
                            </p>
                        </div>
                    </div>
                </div>

            </div>
        </div>
    </div>

    <script>
        // --- 常數定義 ---
        const LEAVE_KEY = 'wenlin_leave_requests';
        const MEDICATION_KEY = 'wenlin_medication_requests';
        const ANNOUNCEMENT_KEY = 'wenlin_announcements';
        const GALLERY_KEY = 'wenlin_gallery_images';
        const CALENDAR_KEY = 'wenlin_calendar_entries'; 
        
        // ** EmailJS 金鑰設定 (用於發送審核通知) **
        const EMAILJS_SERVICE_ID = 'service_e4kb1a4'; 
        const EMAILJS_TEMPLATE_ID_MEDICATION = 'template_yh5wstg'; 
        const EMAILJS_TEMPLATE_ID_LEAVE = 'template_3q1tinr'; 
        const EMAILJS_USER_ID = '0rtERq-KaOIx1yYP9'; 

        // --- 數據存取通用函數 (Local Storage CRUD) ---
        function getRequests(key) {
            try {
                return JSON.parse(localStorage.getItem(key)) || [];
            } catch (e) {
                console.error("Error parsing data from localStorage:", e);
                return [];
            }
        }
        function saveRequests(key, requests) {
            localStorage.setItem(key, JSON.stringify(requests));
        }
        
        // --- 登入/登出邏輯 (Local Storage 模擬) ---
        function handleLogin(event) {
            event.preventDefault();
            const username = document.getElementById('username').value;
            const password = document.getElementById('password').value;

            // 模擬驗證
            if (username === 'teacher' && password === '123456') {
                localStorage.setItem('adminLoggedIn', 'true');
                document.getElementById('login-view').classList.add('hidden');
                document.getElementById('admin-view').classList.remove('hidden');
                loadDashboardData();
            } else {
                const message = document.createElement('div');
                message.className = 'fixed bottom-5 right-5 p-4 bg-red-600 text-white rounded-lg shadow-xl z-50 transition duration-300';
                message.textContent = `登入失敗：請檢查帳號和密碼。`;
                document.body.appendChild(message);
                setTimeout(() => { message.remove(); }, 4000);
            }
        }

        function handleLogout() {
            localStorage.removeItem('adminLoggedIn');
            document.getElementById('login-view').classList.remove('hidden');
            document.getElementById('admin-view').classList.add('hidden');
        }
        
        // --- Tab 切換邏輯 ---
        function showAdminTab(tabName) {
            document.querySelectorAll('.tab-content').forEach(content => {
                content.classList.add('hidden');
            });
            document.querySelectorAll('.tab-btn').forEach(btn => {
                btn.classList.remove('active');
            });

            document.getElementById(tabName).classList.remove('hidden');
            document.querySelector(`.tab-btn[onclick*="'${tabName}'"]`).classList.add('active');

            // 載入該 Tab 的數據
            if (tabName === 'leave-requests') renderLeaveRequests();
            if (tabName === 'medication-requests') renderMedicationRequests();
            if (tabName === 'announcements') renderAnnouncements();
            if (tabName === 'gallery-management') loadGalleryManagement(); // 載入圖片管理數據
            if (tabName === 'calendar-management') loadCalendarManagement(); // 載入行事曆管理數據
        }
        
        // --- 公告管理邏輯 ---
        function getAnnouncements() {
            const announcements = getRequests(ANNOUNCEMENT_KEY);
            return announcements.sort((a, b) => new Date(b.date) - new Date(a.date));
        }

        function saveAnnouncement(event) {
            event.preventDefault();
            const form = event.target;
            const title = form.elements['announcement-title'].value;
            const content = form.elements['announcement-content'].value;
            const tag = form.elements['announcement-tag'].value;
            const date = form.elements['announcement-date'].value;
            const fileURL = document.getElementById('announcement-file-url').value.trim();
            const editIdInput = document.getElementById('edit-announcement-id');
            const editId = editIdInput.value ? parseInt(editIdInput.value) : null;

            let announcements = getRequests(ANNOUNCEMENT_KEY);
            let messageText = '';

            if (editId) {
                const index = announcements.findIndex(ann => ann.id == editId);
                if (index !== -1) {
                    announcements[index] = { 
                        ...announcements[index], 
                        title: title, 
                        content: content, 
                        tag: tag, 
                        date: date, 
                        fileURL: fileURL 
                    };
                    messageText = '公告已成功更新！';
                }
            } else {
                const newAnnouncement = {
                    id: Date.now(),
                    title: title,
                    content: content,
                    tag: tag,
                    date: date,
                    fileURL: fileURL
                };
                announcements.unshift(newAnnouncement); 
                messageText = '新公告已成功儲存！';
            }
            saveRequests(ANNOUNCEMENT_KEY, announcements);
            
            form.reset();
            document.getElementById('announcement-form').querySelector('button[type="submit"]').textContent = '儲存公告並發布';
            editIdInput.value = '';
            document.getElementById('announcement-date').value = new Date().toISOString().split('T')[0];
            
            const message = document.createElement('div');
            message.className = 'fixed bottom-5 right-5 p-4 bg-teal-600 text-white rounded-lg shadow-xl z-50 transition duration-300';
            message.textContent = messageText;
            document.body.appendChild(message);
            setTimeout(() => { message.remove(); }, 3000);
            
            renderAnnouncements();
        }

        function deleteAnnouncement(id) {
            if (!confirm("確定要刪除這則公告嗎？")) return;
            let announcements = getRequests(ANNOUNCEMENT_KEY);
            announcements = announcements.filter(ann => ann.id !== id);
            saveRequests(ANNOUNCEMENT_KEY, announcements);
            renderAnnouncements();
        }
        
        function editAnnouncement(id) {
            const announcements = getAnnouncements();
            const ann = announcements.find(a => a.id === id);

            if (!ann) return;
            
            document.getElementById('announcement-title').value = ann.title;
            document.getElementById('announcement-content').value = ann.content;
            document.getElementById('announcement-tag').value = ann.tag;
            document.getElementById('announcement-date').value = ann.date;
            document.getElementById('announcement-file-url').value = ann.fileURL;

            document.getElementById('edit-announcement-id').value = id;
            document.querySelector('#announcements button[type="submit"]').textContent = '更新公告';
            
            document.getElementById('announcements').scrollIntoView({ behavior: 'smooth' });
        }

        function renderAnnouncements() {
            getAnnouncements().then(announcements => {
                const listContainer = document.getElementById('announcement-list');
                listContainer.innerHTML = '';
                
                if (announcements.length === 0) {
                    listContainer.innerHTML = '<p class="text-stone-500">目前沒有公告。</p>';
                    return;
                }

                announcements.forEach(ann => {
                    const item = document.createElement('div');
                    item.className = 'p-3 bg-gray-50 rounded-lg border border-gray-200 space-y-2';
                    
                    const header = document.createElement('div');
                    header.className = 'flex justify-between items-start';
                    header.innerHTML = `
                        <div>
                            <span class="text-xs font-semibold text-teal-700 mr-2">[${ann.tag}]</span>
                            <span class="font-bold text-lg text-stone-800">${ann.title}</span>
                        </div>
                        <div class="flex space-x-2">
                            <button onclick="editAnnouncement(${ann.id})" class="text-sm text-teal-600 hover:underline">編輯</button>
                            <button onclick="deleteAnnouncement(${ann.id})" class="text-sm text-red-500 hover:text-red-700">刪除</button>
                        </div>
                    `;
                    item.appendChild(header);

                    const contentPreview = ann.content ? ann.content.substring(0, 50) + (ann.content.length > 50 ? '...' : '') : '無內容';
                    const fileName = ann.fileURL ? ann.fileURL.split('/').pop() : '';

                    item.innerHTML += `
                        <p class="text-sm text-stone-600 whitespace-pre-wrap">${contentPreview}</p>
                        <p class="text-xs text-stone-500 mt-1">發布於: ${ann.date}</p>
                        ${ann.fileURL ? `<p class="text-xs text-teal-700 font-medium">附件: <a href="${ann.fileURL}" target="_blank" class="underline hover:text-teal-900">${fileName}</a></p>` : ''}
                    `;
                    
                    listContainer.appendChild(item);
                });
            });
        }
        
        // --- 活動花絮圖片管理邏輯 ---
        function loadGalleryManagement() {
            const imageURLs = getRequests(GALLERY_KEY) || [];
            
            for (let i = 0; i < 4; i++) {
                const input = document.getElementById(`image-url-${i}`);
                if (input) {
                    input.value = imageURLs[i] || '';
                }
            }
            renderGalleryPreviewAdmin(imageURLs);
        }

        function saveGalleryImages(event) {
            event.preventDefault();
            const newURLs = [];
            for (let i = 0; i < 4; i++) {
                const url = document.getElementById(`image-url-${i}`).value.trim();
                newURLs.push(url);
            }
            
            const validURLs = newURLs.filter(url => url !== '');

            saveRequests(GALLERY_KEY, validURLs);

            alert('活動花絮圖片連結已更新！');
            renderGalleryPreviewAdmin(validURLs);
        }

        function renderGalleryPreviewAdmin(imageURLs) {
            const container = document.getElementById('gallery-preview-admin');
            container.innerHTML = '';

            const defaultPlaceholder = "https://placehold.co/150x150/cccccc/333333?text=預覽圖";
            
            for(let i = 0; i < 4; i++) {
                const url = imageURLs[i] || defaultPlaceholder;
                const div = document.createElement('div');
                div.className = 'rounded-xl overflow-hidden shadow-lg aspect-square';
                div.innerHTML = `<img src="${url}" alt="預覽圖 ${i + 1}" class="w-full h-full object-cover" onerror="this.onerror=null;this.src='${defaultPlaceholder}';">`;
                container.appendChild(div);
            }
        }


        // --- 行事曆管理邏輯 ---
        function loadCalendarManagement() {
            document.getElementById('calendar-form').reset();
            document.getElementById('edit-calendar-id').value = '';
            document.getElementById('calendar-form').querySelector('button[type="submit"]').textContent = '新增行事曆項目';
            renderCalendarEntries();
        }

        function getCalendarEntries() {
            const entries = getRequests(CALENDAR_KEY);
            return entries.sort((a, b) => new Date(a.date) - new Date(b.date));
        }

        function saveCalendarEntry(event) {
            event.preventDefault();
            const form = event.target;
            const date = form.elements['calendar-date'].value;
            const title = form.elements['calendar-title'].value;
            const note = form.elements['calendar-note'].value;
            const editIdInput = document.getElementById('edit-calendar-id');
            const editId = editIdInput.value ? parseInt(editIdInput.value) : null;

            let entries = getRequests(CALENDAR_KEY);
            let messageText = '';

            if (editId) {
                // 執行更新
                const index = entries.findIndex(entry => entry.id === editId);
                if (index !== -1) {
                    entries[index] = { ...entries[index], date: date, title: title, note: note };
                    messageText = '行事曆項目已成功更新！';
                }
            } else {
                // 執行創建
                const newEntry = {
                    id: Date.now(),
                    date: date,
                    title: title,
                    note: note
                };
                entries.push(newEntry);
                messageText = '行事曆項目已成功新增！';
            }
            saveRequests(CALENDAR_KEY, entries);
            
            form.reset();
            editIdInput.value = '';
            document.getElementById('calendar-form').querySelector('button[type="submit"]').textContent = '新增行事曆項目';
            
            alert(messageText);
            renderCalendarEntries();
        }

        function deleteCalendarEntry(id) {
            if (!confirm("確定要刪除此行事曆項目嗎？")) return;
            let entries = getRequests(CALENDAR_KEY);
            entries = entries.filter(entry => entry.id !== id);
            saveRequests(CALENDAR_KEY, entries);
            renderCalendarEntries();
        }

        function editCalendarEntry(id) {
            const entries = getCalendarEntries();
            const entry = entries.find(e => e.id === id);

            if (!entry) return;

            // 填入表單
            document.getElementById('calendar-date').value = entry.date;
            document.getElementById('calendar-title').value = entry.title;
            document.getElementById('calendar-note').value = entry.note;

            // 設定編輯模式
            document.getElementById('edit-calendar-id').value = id;
            document.getElementById('calendar-form').querySelector('button[type="submit"]').textContent = '更新項目';
            
            // 捲動到表單頂部
            document.getElementById('calendar-management').scrollIntoView({ behavior: 'smooth' });
        }

        function renderCalendarEntries() {
            const entries = getCalendarEntries();
            const listContainer = document.getElementById('calendar-list');
            listContainer.innerHTML = '';

            if (entries.length === 0) {
                listContainer.innerHTML = '<p class="text-stone-500">目前沒有行事曆項目。</p>';
                return;
            }

            entries.forEach(entry => {
                const item = document.createElement('div');
                item.className = 'p-3 bg-gray-50 rounded-lg border border-gray-200 flex justify-between items-start space-x-4';
                
                item.innerHTML = `
                    <div>
                        <p class="text-xs font-semibold text-teal-700">${entry.date}</p>
                        <span class="font-bold text-base text-stone-800">${entry.title}</span>
                        ${entry.note ? `<p class="text-xs text-stone-500">${entry.note}</p>` : ''}
                    </div>
                    <div class="flex space-x-2 flex-shrink-0">
                        <button onclick="editCalendarEntry(${entry.id})" class="text-sm text-teal-600 hover:underline">編輯</button>
                        <button onclick="deleteCalendarEntry(${entry.id})" class="text-sm text-red-500 hover:text-red-700">刪除</button>
                    </div>
                `;
                listContainer.appendChild(item);
            });
        }

        // --- 請假單列表邏輯 ---
        function getLeaveRequests() {
            const requests = getRequests(LEAVE_KEY);
            return requests.sort((a, b) => new Date(b.timestamp) - new Date(a.timestamp));
        }

        async function updateLeaveStatus(id, newStatus) {
            let requests = getLeaveRequests();
            const index = requests.findIndex(req => req.id === id);
            if (index === -1) return;

            const req = requests[index];

            // 1. 執行 Email 服務 API 呼叫 (真實發送)
            if (!EMAILJS_USER_ID || !EMAILJS_TEMPLATE_ID_LEAVE || !EMAILJS_SERVICE_ID) {
                console.error("錯誤: 請假審核 EmailJS 金鑰/模板 ID 尚未設定! 請檢查程式碼中的設定。");
                alert("錯誤: EmailJS 金鑰尚未設定。無法發送通知。");
                // 仍允許更新狀態
            } else {
                const emailParams = {
                    to_email: req.parentEmail,
                    parent_name: req.parentName,
                    child_name: req.childName,
                    class_name: req.className,
                    start_date: req.startDate,
                    end_date: req.endDate,
                    reason: req.reason,
                    signature_img: req.signature // 簽名 Base64
                };
                
                const API_URL = `https://api.emailjs.com/api/v1.0/email/send`;

                try {
                    const response = await fetch(API_URL, {
                        method: 'POST',
                        headers: { 'Content-Type': 'application/json' },
                        body: JSON.stringify({
                            service_id: EMAILJS_SERVICE_ID,
                            template_id: EMAILJS_TEMPLATE_ID_LEAVE,
                            user_id: EMAILJS_USER_ID,
                            template_params: emailParams
                        })
                    });

                    if (response.ok) {
                        alert(`請假單已審核通過並成功發送 Email 給 ${req.parentEmail}！`);
                    } else {
                        console.error("EmailJS API 呼叫失敗:", response.statusText);
                        alert(`請假單已審核通過，但 Email 發送失敗 (API 錯誤)：${response.statusText}`);
                    }
                } catch (error) {
                    console.error("EmailJS API 呼叫發生錯誤:", error);
                    alert(`請假單已審核通過，但 Email 發送發生錯誤：${error}`);
                }
            }

            // 2. 更新請假狀態並渲染 (Local Storage)
            requests[index].status = newStatus;
            saveRequests(LEAVE_KEY, requests);
            renderLeaveRequests();
            loadDashboardData();
        }

        function renderLeaveRequests() {
             const requests = getLeaveRequests();
             const listContainer = document.getElementById('leave-requests-list');
             listContainer.innerHTML = '';
            
            const pendingRequests = requests.filter(r => r.status === '待審核').length;
            document.getElementById('leave-count').textContent = pendingRequests;

            if (requests.length === 0) {
                listContainer.innerHTML = '<p class="text-stone-500">目前沒有新的請假申請。</p>';
                return;
            }

            requests.forEach((req) => {
                const isPending = req.status === '待審核';
                const statusColor = isPending ? 'bg-amber-100 border-amber-500' : 'bg-teal-100 border-teal-500';
                const statusText = isPending ? '待處理' : '已審核';

                item = document.createElement('div');
                item.className = `p-4 rounded-xl border-l-4 ${statusColor} card-shadow`;
                item.innerHTML = `
                    <div class="flex justify-between items-start">
                        <div>
                            <p class="text-lg font-bold text-stone-800">${req.childName} (${req.className})</p>
                            <p class="text-sm text-stone-600">家長: ${req.parentName} (${req.relationship})</p>
                            <p class="text-sm text-stone-600">期間: ${req.startDate} ~ ${req.endDate}</p>
                            <p class="text-sm font-medium text-red-700 mt-1">原因: ${req.reason}</p>
                            <p class="text-xs text-stone-500 mt-2">接收通知 Email: ${req.parentEmail}</p>
                            <p class="text-xs text-stone-500">提交時間: ${new Date(req.timestamp).toLocaleString('zh-TW')}</p>
                        </div>
                        <div class="text-right">
                            <span class="text-xs font-semibold px-2 py-1 rounded-full ${isPending ? 'bg-red-500 text-white' : 'bg-green-500 text-white'}">${statusText}</span>
                            <p class="text-xs text-stone-500 mb-2">簽名: <a href="${req.signature}" target="_blank" class="text-teal-700 hover:underline">查看簽名圖</a></p>
                            ${isPending ? `<button onclick="updateLeaveStatus(${req.id}, '已審核')" class="mt-2 text-sm text-teal-700 hover:underline font-bold">標記為已審核</button>` : ''}
                        </div>
                    </div>
                `;
                listContainer.appendChild(item);
            });
        }
        
        // --- 託藥單列表與回覆邏輯 ---
        function getMedicationRequests() {
            const requests = getRequests(MEDICATION_KEY);
            return requests.sort((a, b) => new Date(b.timestamp) - new Date(a.timestamp));
        }

        async function handleTeacherReply(event, id) {
            event.preventDefault();
            
            const form = event.target;
            const requests = getMedicationRequests();
            const index = requests.findIndex(req => req.id === id);

            if (index === -1) return;

            const req = requests[index];

            const reply = {
                time: form.elements.teacher_time.value,
                note: form.elements.teacher_note.value,
                teacher: form.elements.teacher_name.value,
                timestamp: new Date().toISOString()
            };

            // 1. 執行 EmailJS API 呼叫 (使用 fetch) - 真實發送
            if (!EMAILJS_USER_ID || !EMAILJS_TEMPLATE_ID_MEDICATION || !EMAILJS_SERVICE_ID) {
                console.error("錯誤: 託藥回覆 EmailJS 金鑰/模板 ID 尚未設定! 請檢查程式碼中的設定。");
                alert("錯誤: EmailJS 金鑰尚未設定。無法發送通知。");
            } else {
                const emailParams = {
                    to_email: req.parentEmail,
                    child_name: req.childName,
                    class_name: req.className,
                    medication_details: req.medicationDetails.replace(/\n/g, '<br>'),
                    reply_time: reply.time,
                    reply_note: reply.note.replace(/\n/g, '<br>'),
                    teacher_name: reply.teacher
                };
                
                const API_URL = `https://api.emailjs.com/api/v1.0/email/send`;

                try {
                    const response = await fetch(API_URL, {
                        method: 'POST',
                        headers: { 'Content-Type': 'application/json' },
                        body: JSON.stringify({
                            service_id: EMAILJS_SERVICE_ID,
                            template_id: EMAILJS_TEMPLATE_ID_MEDICATION,
                            user_id: EMAILJS_USER_ID,
                            template_params: emailParams
                        })
                    });

                    if (response.ok) {
                        alert(`回覆已記錄，Email 成功發送給家長: ${req.parentEmail}`);
                    } else {
                        console.error("EmailJS API 呼叫失敗:", response.statusText);
                        alert(`Email 發送失敗 (API 呼叫失敗，請檢查 EmailJS 網站設定)：${response.statusText}`);
                    }
                } catch (error) {
                    console.error("EmailJS API 呼叫發生錯誤:", error);
                    alert(`Email 發送發生錯誤：${error}`);
                }
            }

            // 2. 儲存回覆並更新後台介面
            requests[index].teacherReply = reply;
            saveRequests(MEDICATION_KEY, requests);
            
            const message = document.createElement('div');
            message.className = 'fixed bottom-5 right-5 p-4 bg-teal-600 text-white rounded-lg shadow-xl z-50 transition duration-300';
            message.textContent = `回覆已記錄，並已嘗試發送 Email 給家長: ${req.parentEmail}`;
            document.body.appendChild(message);
            setTimeout(() => { message.remove(); }, 3000);
            
            renderMedicationRequests();
            loadDashboardData();
        }

        function renderMedicationRequests() {
            getMedicationRequests().then(requests => {
                const listContainer = document.getElementById('medication-requests-list');
                listContainer.innerHTML = '';
                
                const pendingRequests = requests.filter(r => r.teacherReply === undefined || r.teacherReply === null || !r.teacherReply.time).length;
                document.getElementById('medication-count').textContent = pendingRequests;

                if (requests.length === 0) {
                    listContainer.innerHTML = '<p class="text-stone-500">目前沒有新的託藥申請。</p>';
                    return;
                }

                requests.forEach((req) => {
                    const isReplied = req.teacherReply && req.teacherReply.time;
                    const statusColor = isReplied ? 'bg-green-100 border-green-500' : 'bg-amber-100 border-amber-500';
                    
                    const item = document.createElement('div');
                    item.className = `p-4 rounded-xl border-l-4 ${statusColor} card-shadow`;
                    
                    item.innerHTML = `
                        <div class="text-lg font-bold text-stone-800 flex justify-between items-center">
                            ${req.childName} (${req.className}) - 託藥單
                            <span class="text-xs font-semibold px-2 py-1 rounded-full ${isReplied ? 'bg-green-500 text-white' : 'bg-red-500 text-white'}">${isReplied ? '已回覆' : '待回覆'}</span>
                        </div>
                        <p class="text-sm text-stone-600">期間: ${req.startDate} ~ ${req.endDate} | 服藥時間: ${req.time}</p>
                        <p class="text-sm text-stone-600">病名/病徵: ${req.symptoms} | 處方簽確認: ${req.prescriptionConfirm ? '是' : '否'}</p>
                        <p class="text-sm text-stone-800 font-medium mt-1">用藥內容: <span class="text-teal-700 whitespace-pre-wrap">${req.medicationDetails}</span></p>
                        <p class="text-sm text-stone-600 mb-3">家長 Email: <span class="text-teal-700">${req.parentEmail}</span></p>
                        <p class="text-xs text-stone-500 mb-3">簽名: <a href="${req.parentSignature}" target="_blank" class="text-teal-700 hover:underline">查看簽名圖</a></p>

                        ${isReplied ? `
                            <div class="mt-3 p-3 bg-green-50 rounded-lg border border-green-300">
                                <p class="font-bold text-green-700">✅ 教師回覆記錄 (${req.teacherReply.teacher})</p>
                                <p class="text-sm text-green-600">時間: ${req.teacherReply.time}</p>
                                <p class="text-sm text-green-600 whitespace-pre-wrap">情況: ${req.teacherReply.note}</p>
                                <button onclick="deleteMedicationEntry(${req.id})" class="mt-2 text-xs text-red-500 hover:underline">刪除此記錄</button>
                            </div>
                        ` : `
                            <form onsubmit="handleTeacherReply(event, ${req.id})" class="mt-3 space-y-2 p-3 bg-white rounded-lg border border-gray-300">
                                <h5 class="font-semibold text-teal-700">老師回覆區 (即時發送 Email 給 ${req.parentEmail})</h5>
                                <input type="text" name="teacher_time" placeholder="餵藥時間 (e.g., 12:35 PM)" required>
                                <textarea name="teacher_note" placeholder="餵藥情況回覆" rows="2" required></textarea>
                                <input type="text" name="teacher_name" placeholder="操作教師姓名 (e.g., 吳老師)" required>
                                <button type="submit" class="w-full py-2 bg-teal-600 text-white text-sm font-bold rounded-lg hover:bg-teal-700 transition">送出餵藥回覆</button>
                            </form>
                        `}
                    `;
                    listContainer.appendChild(item);
                });
            });
        }

        function deleteMedicationEntry(id) {
            if (!confirm("確定要清除此託藥回覆記錄嗎？")) return;
            let requests = getMedicationRequests();
            const index = requests.findIndex(req => req.id === id);
            
            if (index !== -1) {
                 requests[index].teacherReply = null; // 清除回覆
                 saveRequests(MEDICATION_KEY, requests);
                 renderMedicationRequests();
                 loadDashboardData();
            }
        }


        // --- 行事曆管理邏輯 ---
        function loadCalendarManagement() {
            document.getElementById('calendar-form').reset();
            document.getElementById('edit-calendar-id').value = '';
            document.getElementById('calendar-form').querySelector('button[type="submit"]').textContent = '新增行事曆項目';
            renderCalendarEntries();
        }

        function getCalendarEntries() {
            const entries = getRequests(CALENDAR_KEY);
            return entries.sort((a, b) => new Date(a.date) - new Date(b.date));
        }

        function saveCalendarEntry(event) {
            event.preventDefault();
            const form = event.target;
            const date = form.elements['calendar-date'].value;
            const title = form.elements['calendar-title'].value;
            const note = form.elements['calendar-note'].value;
            const editIdInput = document.getElementById('edit-calendar-id');
            const editId = editIdInput.value ? parseInt(editIdInput.value) : null;

            let entries = getRequests(CALENDAR_KEY);
            let messageText = '';

            if (editId) {
                // 執行更新
                const index = entries.findIndex(entry => entry.id === editId);
                if (index !== -1) {
                    entries[index] = { ...entries[index], date: date, title: title, note: note };
                    messageText = '行事曆項目已成功更新！';
                }
            } else {
                // 執行創建
                const newEntry = {
                    id: Date.now(),
                    date: date,
                    title: title,
                    note: note
                };
                entries.push(newEntry);
                messageText = '行事曆項目已成功新增！';
            }
            saveRequests(CALENDAR_KEY, entries);
            
            form.reset();
            editIdInput.value = '';
            document.getElementById('calendar-form').querySelector('button[type="submit"]').textContent = '新增行事曆項目';
            
            alert(messageText);
            renderCalendarEntries();
        }

        function deleteCalendarEntry(id) {
            if (!confirm("確定要刪除此行事曆項目嗎？")) return;
            let entries = getRequests(CALENDAR_KEY);
            entries = entries.filter(entry => entry.id !== id);
            saveRequests(CALENDAR_KEY, entries);
            renderCalendarEntries();
        }

        function editCalendarEntry(id) {
            const entries = getCalendarEntries();
            const entry = entries.find(e => e.id === id);

            if (!entry) return;

            // 填入表單
            document.getElementById('calendar-date').value = entry.date;
            document.getElementById('calendar-title').value = entry.title;
            document.getElementById('calendar-note').value = entry.note;

            // 設定編輯模式
            document.getElementById('edit-calendar-id').value = id;
            document.getElementById('calendar-form').querySelector('button[type="submit"]').textContent = '更新項目';
            
            // 捲動到表單頂部
            document.getElementById('calendar-management').scrollIntoView({ behavior: 'smooth' });
        }

        function renderCalendarEntries() {
            const entries = getCalendarEntries();
            const listContainer = document.getElementById('calendar-list');
            listContainer.innerHTML = '';

            if (entries.length === 0) {
                listContainer.innerHTML = '<p class="text-stone-500">目前沒有行事曆項目。</p>';
                return;
            }

            entries.forEach(entry => {
                const item = document.createElement('div');
                item.className = 'p-3 bg-gray-50 rounded-lg border border-gray-200 flex justify-between items-start space-x-4';
                
                item.innerHTML = `
                    <div>
                        <p class="text-xs font-semibold text-teal-700">${entry.date}</p>
                        <span class="font-bold text-base text-stone-800">${entry.title}</span>
                        ${entry.note ? `<p class="text-xs text-stone-500">${entry.note}</p>` : ''}
                    </div>
                    <div class="flex space-x-2 flex-shrink-0">
                        <button onclick="editCalendarEntry(${entry.id})" class="text-sm text-teal-600 hover:underline">編輯</button>
                        <button onclick="deleteCalendarEntry(${entry.id})" class="text-sm text-red-500 hover:text-red-700">刪除</button>
                    </div>
                `;
                listContainer.appendChild(item);
            });
        }

        // --- 儀表板通用加載 ---
        function loadDashboardData() {
            const leaveRequests = getLeaveRequests();
            const medicationRequests = getMedicationRequests();

            const pendingLeaves = leaveRequests.filter(r => r.status === '待審核').length;
            const pendingMedications = medicationRequests.filter(r => r.teacherReply === undefined || r.teacherReply === null || !r.teacherReply.time).length;

            document.getElementById('leave-count').textContent = pendingLeaves;
            document.getElementById('medication-count').textContent = pendingMedications;
            
            showAdminTab('announcements');
        }

        // 檢查是否已登入 (在 DOM 載入後執行)
        document.addEventListener('DOMContentLoaded', () => {
            // 附加事件監聽器到表單和按鈕
            document.getElementById('login-form').addEventListener('submit', handleLogin);
            document.getElementById('announcement-form').addEventListener('submit', saveAnnouncement);
            document.getElementById('gallery-form').addEventListener('submit', saveGalleryImages);
            document.getElementById('calendar-form').addEventListener('submit', saveCalendarEntry);

            // 確保公告的發布日期預設為今天
            const dateInput = document.getElementById('announcement-date');
            if (dateInput) {
                dateInput.value = new Date().toISOString().split('T')[0];
            }
            
            // 檢查 Local Storage 狀態進行模擬登入
            if (localStorage.getItem('adminLoggedIn') === 'true') {
                document.getElementById('login-view').classList.add('hidden');
                document.getElementById('admin-view').classList.remove('hidden');
                loadDashboardData();
            }
        });
    </script>
</body>
